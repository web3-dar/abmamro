/*! aab-analytics-body.js main-v1.07 */
// Digital Event Queue - 2.0.0 core - https://github.com/digital-power/DEQ
"function"!=typeof DigitalEventQueue&&(window.DigitalEventQueue=function DigitalEventQueue(e,t){"use strict";if(DigitalEventQueue.queue[e])return DigitalEventQueue.queue[e];var i=DigitalEventQueue.queue[e]=this;i.version="2.0.0 core",i.name=e,i.listeners=[],i.events=[],i.history=[],i.global={},i.push=function(e){if(i.history.push(e),r(e)&&e.command)switch(e.command){case"ADD EVENT":d(e);break;case"ADD LISTENER":n(e);break;case"GLOBAL DATA":l(e);break;default:s("push","unknown command: "+e.command,{input:e})}else s("push","invalid input",{input:e})},i.unshift=i.push;function a(t,n){try{var e={name:t[0],data:t[1]},a={name:n[0],matchEvent:n[1],handler:n[2]},r=new RegExp("^"+a.matchEvent+"$","i");!e.name.match(r)||e.name.match(/^deq error$/i)&&".*"==a.matchEvent||function(t,e,n,a){try{n.call(n,t,c(e),i)}catch(e){"deq error"!=t&&s("listener","listener ("+a+") failed on '"+t,e,t,a)}}(e.name,e.data,a.handler,a.name)}catch(e){s("checkAndExecuteEventMatch",e.message,{event:t,listener:n,error:e})}}var r=function(e){return"[object Object]"==Object.prototype.toString.call(e)},o=function(){var n={};return[].splice.call(arguments,0).forEach(function(t){r(t)&&Object.keys(t).forEach(function(e){r(n[e])&&r(t[e])?n[e]=o(n[e],t[e]):n[e]=u(t[e])})}),n},u=function(e){if(r(e))return c(e);if(Array.isArray(e)){var t=[];return e.forEach(function(e){t.push(u(e))}),t}return e},c=function(e){return o(e)},s=function(e,t,n,a,r){n=n||{},i.push({command:"ADD EVENT",name:"deq error",data:{deq_error_type:e,deq_error_message:t,deq_error_obj:n,deq_error_event:a,deq_error_listener:r}})},n=function(e){var t;r(e)&&"function"==typeof e.handler&&"string"==typeof e.matchEvent?(e.name=e.name||"unnamed listener",t=[e.name,e.matchEvent,e.handler],i.listeners.push(t),e.skipHistory||i.events.forEach(function(e){a(e,t)})):s("add listener","invalid input",{input:e})},d=function(t){if("string"!=typeof t.name||void 0!==t.data&&!r(t.data))s("add event","invalid input",{input:t});else try{var e=o(i.global,t.data,{deq_event:t.name,deq_event_ts:(new Date).getTime()}),n=[t.name,e];i.events.push(n),i.listeners.forEach(function(e){a(n,e)})}catch(e){s("add event","invalid event object",e,t.name)}},l=function(e){r(e.data)&&(i.global=o(i.global,e.data))};Object.getPrototypeOf(i).constructor===DigitalEventQueue&&Array.isArray(t)&&t.forEach(function(e){i.push(e)})},DigitalEventQueue.prototype=[],DigitalEventQueue.prototype.constructor=DigitalEventQueue,DigitalEventQueue.queue={});
// DEQ Plugin: iframe v1.1
DigitalEventQueue.plugin=DigitalEventQueue.plugin||{};DigitalEventQueue.plugin.iframe=function(c){window.self==window.top?window.addEventListener("message",function(a){a&&a.data&&a.data.eventName&&a.data.eventData&&a.data.eventData.deq_iframe&&(new DigitalEventQueue(c)).push({command:"ADD EVENT",name:a.data.eventName,data:a.data.eventData})},!1):(new DigitalEventQueue(c)).push({command:"ADD LISTENER",name:"iframe plugin",matchEvent:"..*",handler:function(a,b,d){b=b||{};b.deq_iframe=1;b.deq_iframe_url=document.location.href;parent.postMessage({eventName:a,eventData:b},"*")}})};
// AAB Analytics Init v1.2
(function(){var a=window.aabAnalyticsGlobal=window.aabAnalyticsGlobal||{};a.app_analytics_js_body="main-v1.07";window.aabAnalytics=window.aabAnalytics||[];window.aabAnalytics.unshift({command:"GLOBAL DATA",data:a});window.aabAnalytics=new DigitalEventQueue("AAB Analytics",window.aabAnalytics);window.aabAnalytics.addEvent=function(b,c){window.aabAnalytics.push({command:"ADD EVENT",name:b,data:c})};DigitalEventQueue.plugin.iframe("AAB Analytics")})();
// AAB getSession v1.2
aabAnalytics.getSession=function(b){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){if(a.responseText)try{var c=JSON.parse(a.responseText).session||{},d="not available";c.representedCustomer?d=c.representedCustomer.toString():"object"===typeof c.representative&&c.representative.reference&&(d=c.representative.reference.toString())}catch(e){}b.call(b,"true",d)}else b.call(b,"false")};a.open("GET","/session",!0);a.setRequestHeader("x-aab-serviceversion","v3");a.send()};document.location.hostname.match(/^www(-et\d)?\.abnamro\.nl$/)&&window.self==window.top&&aabAnalytics.getSession(function(b,a){aabAnalyticsGlobal.user_is_logged_in=b;a&&(aabAnalyticsGlobal.user_bc_number=a)});
// Tealium Connector v1.1: abn-amro/main
(function(){if(window.self==window.top){var b="qa";window.aabAnalyticsGlobal&&"prod"===aabAnalyticsGlobal.app_environment&&(b="prod");var a=document.location.href.split("tealium=");1<a.length&&(a=a[1].split("&")[0].split("#")[0])&&/^[a-zA-Z\-]+$/.test(a)&&sessionStorage.setItem("tealium_env",a);b=sessionStorage.getItem("tealium_env")||b;"off"!==b&&(a=document.createElement("script"),a.type="text/javascript",a.async=!0,a.src="//tags.tiqcdn.com/utag/abn-amro/main/"+b+"/utag.js",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b))}})();
// aab-analytics-event-handler listener v1.1
document.addEventListener("analytics-event-handler",function(a){(a=a.detail)&&a.eventCategory&&aabAnalytics.addEvent("aab-analytics-event-handler",a)});
// DEQ Click Events v1.1
document.addEventListener("mousedown",function(d){try{if("function"==typeof d.composedPath){var e=d.composedPath(),a={};Array.isArray(e)&&e.forEach(function(b){"function"===typeof b.getAttributeNames&&b.getAttributeNames().forEach(function(c){if(0===c.indexOf("data-")){var f=c.replace(/-/g,"_").replace(/data/,"html").toLowerCase();"undefined"==typeof a[f]&&(a[f]=b.getAttribute(c))}})});a.html_element_type&&aabAnalytics.addEvent("click",a)}}catch(b){}});
// DEQ Element Visibility and Video Events v1.1
(function(){var n=function(a){var b=a.target,c={video_action:a.type,video_url:b.currentSrc,video_current_time:b.currentTime,video_duration:b.duration,video_title:b.dataset.contentGroupTitle,video_id:b.dataset.contentGroupId,video_provider:"native"};switch(a.type){case "play":case "pause":case "volumechange":aabAnalytics.addEvent("video",c);break;case "timeupdate":try{var d=b.currentTime/b.duration*100,f=Number(b.dataset.videoMilestoneReached||0);[5,25,50,75,95].forEach(function(e){d>=e&&e>f&&(b.dataset.videoMilestoneReached=e,c.video_percent=e,aabAnalytics.addEvent("video",c))})}catch(e){}}},h=function(a){["play","pause","timeupdate","volumechange"].forEach(function(b){a.addEventListener(b,n)})};Array.from(document.getElementsByTagName("VIDEO")).forEach(function(a){h(a)});var k=function(a,b){"function"===typeof a.getAttributeNames&&a.getAttributeNames().forEach(function(d){if(0===d.indexOf("data-")){var f=d.replace(/-/g,"_").replace(/data/,"html").toLowerCase();"undefined"===typeof b[f]&&(b[f]=a.getAttribute(d))}});var c=a.parentElement||a.parentNode||a.host;"object"===typeof c&&null!==c&&k(c,b)},l=function(a){if("object"===typeof a.target&&null!==a.target&&a.target.hasAttribute("data-track-visibility")){var b={};k(a.target,b);a.target.removeAttribute("data-track-visibility");aabAnalytics.addEvent("element visibility",b)}},m=function(a){var b=a.dataset;if(b&&b.analyticsTitle&&0===a.tagName.indexOf("AAB-")){var c=b.analyticsTitle;switch(a.tagName.split("-")[1]){case "NOTIFICATION":b.componentType="aab-notification";b.contentGroupTitle=c;b.contentGroupType="notification";b.contentGroupStyle=a.type;a.setAttribute("data-track-visibility","1");break;case "LINK":b.elementType="textlink";b.elementLabel=c;b.elementTarget=b.elementTarget||a.url||"";b.elementStyle=a.type;break;case "BUTTON":b.elementType="button",b.elementLabel=c,b.elementStyle=a.type}}},g=function(a){m(a);a.dataset&&a.dataset.trackVisibility&&aabAnalytics.intersectionObserver.observe(a);"VIDEO"===a.tagName&&h(a);a.childNodes&&a.childNodes.length&&a.childNodes.forEach(g)};aabAnalytics.intersectionObserver=new IntersectionObserver(function(a,b){try{a.forEach(function(c){c.target.scrollHeight>document.documentElement.clientHeight&&0<c.intersectionRatio?l(c):.75<c.intersectionRatio&&l(c)})}catch(c){}},{root:null,rootMargin:"0px",threshold:[0,.75]});g(document);aabAnalytics.mutationObserver=new MutationObserver(function(a){try{a.forEach(function(b){if(b.attributeName&&"data-track-visibility"===b.attributeName){var c=b.target;c.dataset.trackVisibility?aabAnalytics.intersectionObserver.observe(c):aabAnalytics.intersectionObserver.unobserve(c)}b.attributeName&&"data-analytics-title"===b.attributeName&&m(b.target);b.addedNodes&&b.addedNodes.length&&b.addedNodes.forEach(g)})}catch(b){}});aabAnalytics.mutationObserver.observe(document,{attributes:!0,childList:!0,subtree:!0});var p=HTMLElement.prototype.attachShadow;HTMLElement.prototype.attachShadow=function(a){a=p.call(this,a);try{aabAnalytics.mutationObserver.observe(a,{attributes:!0,childList:!0,subtree:!0})}catch(b){}return a}})();